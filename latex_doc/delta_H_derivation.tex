\documentclass[./main.tex]{subfiles}
\graphicspath{{\subfix{../images/}}}
\begin{document}


\subsubsection{$\langle \Delta H_{SD} \rangle$ Derivation}

\noindent The equation $H = -q(1-q)$ defines a constant of motion for the SD part of the game,
where q is the fraction of players in the 4th strategy. Using the transition probabilities of 
the different process we can derive an expression for the expected change in H within the simplex.

\hfill

\noindent Where $i, j, k, N-i-j-k$ are the players playing R, P, S, and the 4th strategy respectively.



\hfill

\noindent $\Delta H = H(t+1) - H(t)$, \\
$\Delta H = -x_{t+1}(1-x_{t+1}) - (-x_{t}(1-x_t))$ \\
$\Delta H = -x_{t+1}(1-x_{t+1}) + x_{t}(1-x_t)$ \\
$\Delta H = x_{t}(1-x_t) -x_{t+1}(1-x_{t+1})$ \\

\hfill


$\langle \Delta H \rangle = \sum_{i,j,k}\Big(H_s - H_{s'}\Big)T^{s \rightarrow s'}$, $s$ is a 
particular state in the simplex.



\begin{equation} \label{delta_h_snowdrift}
\begin{aligned}
  \langle \Delta H_{SD} \rangle &= \frac{6}{N^5} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}\Big[(N-i-j-k)(1-N+i+j+k)(T^{R+} + T^{P+} + T^{S+}+ T^{+R}+ T^{+P} +T^{+S}) \\
  &- (N-i-j-k + 1)(-N+i+j+k)T^{R+} \\
  &- (N-i-j-k + 1)(-N + i + j + k)T^{P+} \\
  &- (N-i-j-k - 1)(2 - N + i + j + k)T^{+R} \\
  &- (N - i - j - k - 1)(2 - N + i + j + k)T^{+P} \\
  &- (N - i - j - k - 1)(2 - N + i + j + k)T^{+S}\Big]
\end{aligned}
\end{equation}
The terms with transitions within the RPS simplex can be ignored as $q$ would not change between these states, therefore the term $H_s - H_{s'} = 0$ 


\hfill

$p = N - i - j - k$, the number of players playing the 4th strategy.


\begin{equation} \nonumber
\begin{aligned}
  \langle \Delta H_{SD} \rangle &= \frac{6}{N^5} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}\Big[p(1-p)(T^{R+} + T^{P+} + T^{S+}+ T^{+R}+ T^{+P} +T^{+S}) \\
  &- (p + 1)(-p)(T^{R+} + T^{P+} + T^{S+}) \\
  &- (p-1)(2 -p)(T^{+R} + T^{+P} + T^{+S})\Big]
\end{aligned}
\end{equation}


\begin{equation} \nonumber
\begin{aligned}
\langle \Delta H_{SD} \rangle &= \frac{6}{N^5} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N} 
\Big[T^{R+}\left(p(1-p) + p(p+1)\right) + T^{+R}\left(p(1-p) - (p-1)(2-p)\right) \\
&+ T^{P+}\left(p(1-p) + p(p+1)\right) + T^{+P}\left(p(1-p) - (p-1)(2-p)\right) \\
&+ T^{S+}\left(p(1-p) + p(p+1)\right) + T^{+S}\left(p(1-p) - (p-1)(2-p)\right) 
\Big] \\
&= \frac{6}{N^5} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N} \Big[
2p\left(T^{R+} + T^{P+} + T^{S+}\right) + (p - p^2 - (3p - p^2 -2))(T^{+R} + T^{+P} + T^{+S})
\Big] \\
&= \frac{6}{N^5} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}\Big[
2p\left(T^{R+} + T^{P+} + T^{S+}\right) + (2 - 2p)(T^{+R} + T^{+P} + T^{+S})
\Big] 
\end{aligned}
\end{equation}


\begin{equation} \nonumber
\langle \Delta H_{SD} \rangle = \frac{12}{N^5} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N} \Big[
p\left(T^{R+} + T^{P+} + T^{S+}\right) + (1 - p)(T^{+R} + T^{+P} + T^{+S})
\Big]
\end{equation}

\begin{equation}
\begin{aligned}
\langle \Delta H_{SD} \rangle &= \frac{12}{N^5} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}
p\Big[ (T^{R+} - T^{+R}) + (T^{P+} - T^{+P}) +(T^{S+} - T^{+S}) \Big]+ T^{+R} + T^{+P} + T^{+S}
\end{aligned}
\end{equation}

The continuous limit, where $x = i/N$, $y = j/N$, $z = k/N$, and $q = p/N$, $p = Nq$ and $q = 1 - x - y - z$ leads to:

\begin{equation} \nonumber
\begin{aligned}
\langle \Delta H_{SD} \rangle &= \frac{12}{N^2} \int_{0}^{1}dx \int_{0}^{1-x} dy \int_{0}^{1-x-y}dz 
\Big[Nq\left[(T^{R+} - T^{+R}) + (T^{P+} - T^{+P}) +(T^{S+} - T^{+S})\right] \\
&+ (T^{+R} + T^{+P} + T^{+S}) \Big]
\end{aligned}
\end{equation}

Finally,

\begin{equation}
\begin{aligned}
\langle \Delta H_{SD} \rangle &= \frac{12}{N} \int_{0}^{1}dx \int_{0}^{1-x} dy \int_{0}^{1-x-y}dz 
\Big[q\left[(T^{R+} - T^{+R}) + (T^{P+} - T^{+P}) +(T^{S+} - T^{+S})\right]\Big] \\
&+ \frac{12}{N^2} \int_{0}^{1}dx \int_{0}^{1-x} dy \int_{0}^{1-x-y}dz\left[T^{+R} + T^{+P} + T^{+S}\right]
\end{aligned}
\end{equation}

This can then be solved numerically and the critical population values
can be found where $\langle \Delta H_{SD} \rangle = 0$.


\hfill



\hfill
\par
Critical N found matches nicely with the simulated versions. 
Numerical integration in python code ./augRps.py, shows change of sign as expected. Matches nicely with the approximated values for the Moran process.
The specific expression for Moran process is very long. Computed numerically and solved with scipy.integrate (reference scipy)
Maybe can plot the simulated critical population sizes against the analyical on the same graph.


\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{./images/critical_n_analytical.png}
    \caption{Comparison of simulated critical population sizes against the derived expected change in H for Moran process. Small deviations due
    to stochasticity in the simulations. $\gamma = 0.2, \beta = 0.1$ standard RPS.}
\end{figure}


\subsubsection{$\langle \Delta H_{RPS} \rangle$ Derivation}

$\langle \Delta H \rangle$ within the RPS plane $H = -xyz$.

\begin{equation} \nonumber
\begin{aligned}
  \langle \Delta H_{RPS} \rangle &= \frac{2}{N^6} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}\Big[ijk(T^{RP} + T^{RS} + T^{R+} + T^{PR} + T^{PS} + T^{P+} \\
  &+ T^{SR} + T^{SP} + T^{S+} + T^{+R} + T^{+P} + T^{+S}) \\
  &- k(i-1)(j+1)T^{RP} - (i-1)j(k+1)T^{RS} - jk(i-1)T^{R+} \\
  &- k(i+1)(j-1)T^{PR} - i(j-1)(k+1)T^{PS} - ik(j-1)T^{P+} \\
  &- (i+1)j(k-1)T^{SR} - i(j+1)(k-1)T^{SP} - ij(k-1)T^{S+} \\
  &- jk(i+1)T^{+R} - ik(j+1)T^{+P} - ij(k+1)T^{+S}\Big]
\end{aligned}
\end{equation}




\begin{equation} 
\begin{aligned}
  \langle \Delta H_{RPS} \rangle &= \frac{2}{N^6} \sum_{i=1}^{N}\sum_{j=1}^{N}\sum_{k=1}^{N}
  \Big[k(j-i)(T^{RP} - T^{PR}) + j(k-i)(T^{RS} - T^{SR}) + i(j-k)(T^{SP} - T^{PS}) \\
  &+ k(T^{RP} + T^{PR}) + j(T^{RS} + T^{SR}) + i(T^{SP} + T^{PS}) \\
  &+ jk(T^{R+} - T^{+R}) + ik(T^{P+} - T^{+P}) + ij(T^{S+} - T^{+S})
  \Big]
\end{aligned}
\end{equation}
Compared to the derivation of simply the RPS case in\cite{PhysRevLett.100.058104_cyclic}, this has the additional
terms including the difference in tranition probabilities in and out of the 4th strategy.


\begin{equation} \nonumber
\begin{aligned}
  \langle \Delta H_{RPS} \rangle &= \frac{2}{N^3} \int_{0}^{1}dx \int_{0}^{1-x} dy \int_{0}^{1-x-y}dz 
  \Big[N^2z(y-x)(T^{RP} - T^{PR}) + N^2y(z-x)(T^{RS} - T^{SR}) \\
  &+ N^2x(y-z)(T^{SP} - T^{PS}) \\
  &+ Nz(T^{RP} + T^{PR}) + Ny(T^{RS} + T^{SR}) + Nx(T^{SP} + T^{PS}) \\
  &+ N^2xz(T^{P+} - T^{+P}) + N^2yz(T^{R+} - T^{+R}) + N^2xy(T^{S+} - T^{+S})
  \Big]
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
  \langle \Delta H_{RPS} \rangle &= \frac{2}{N} \int_{0}^{1}dx \int_{0}^{1-x} dy \int_{0}^{1-x-y}dz 
  \Big[z(y-x)(T^{RP} - T^{PR}) + y(z-x)(T^{RS} - T^{SR}) \\
  &+ x(y-z)(T^{SP} - T^{PS}) + xz(T^{P+} - T^{+P})+ yz(T^{R+} - T^{+R}) + xy(T^{S+} - T^{+S})
  \Big] \\
  &+ \frac{2}{N^2} \int_{0}^{1}dx \int_{0}^{1-x} dy \int_{0}^{1-x-y}dz\Big[
  z(T^{RP} + T^{PR}) + y(T^{RS} + T^{SR}) + x(T^{SP} + T^{PS})\Big]
\end{aligned}
\end{equation}


Rough figures of rps and SD delta H values.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{./images/rps_sd_delta_H.png}
    \caption{Blue - SD}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{./images/sd_rps_double_drift.png}
    \caption{Double reversal case. Blue - SD}
\end{figure}

\subsubsection{$\langle \Delta H_4 \rangle$ Derivation}



All 4 strategies, $H = -xyz(1-x-y-z)$
As above.


\end{document}